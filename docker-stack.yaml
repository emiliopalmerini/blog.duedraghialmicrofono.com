 services:
  web:
    image: klakegg/hugo:latest # Usa un'immagine Hugo preesistente
    command: hugo server --bind=0.0.0.0 --port=1313 --disableFastRender
    volumes:
      - .:/src
      - hugo_public:/src/public
    working_dir: /src
    labels:
      - "traefik.enable=true"
      - "traefik.http.middlewares.website-ratelimit.ratelimit.average=20"
      - "traefik.http.routers.website.rule=Host(`duedraghialmicrofono.com`) && !Method(`POST`)"
      - "traefik.http.services.website.loadbalancer.server.port=8080"
      - "traefik.http.routers.website.entrypoints=websecure"
      - "traefik.http.routers.website.tls.certresolver=myresolver"
      - "traefik.http.routers.website.middlewares=website-ratelimit"
      # Define separate router for POST methods
      # - "traefik.http.middlewares.website-ratelimit-post.ratelimit.average=1"
      # - "traefik.http.middlewares.website-ratelimit-post.ratelimit.period=1m"
      # - "traefik.http.routers.website-post.rule=Host(`duedraghialmicrofono.com`) && Method(`POST`)"
      # - "traefik.http.routers.website-post.middlewares=guestbook-ratelimit-post"
      # - "traefik.http.routers.website-post.entrypoints=websecure"
      # - "traefik.http.routers.website-post.tls.certresolver=myresolver"
      # Proxy
      # - "traefik.http.routers.proxy.rule=Host(`proxy.duedraghialmicrofono.com`)"
      # - "traefik.http.routers.proxy.entrypoints=websecure"
      # - "traefik.http.routers.proxy.tls.certresolver=myresolver"
    networks:
      - duedraghi-site_traefik_proxy
    deploy:
      replicas: 1

 volumes:
   hugo_public:
 
 networks:
  duedraghi-site_traefik_proxy:
    external: true
